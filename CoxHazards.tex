\chapter{Cox Proportional Hazards Model}
\label{cox_proportional_hazards_model}

\section{Introduction}

Many of the clinical and imaging features that were found to be associated with survival in Chapter~\ref{literature_review} were found using the Cox proportional hazards (CPH) model.
CPH is a survival analysis model that is used to investigate the relationship between the time to an event and the factors that may influence it.

As a first step in my investigation into the predictive power of clinical and imaging features in MND, I used a CPH model to investigate the relationship between the time to death and the clinical and neuroimaging features that were extracted from the ALS Biomarkers Study and Ospedale San Raffaele MND cohorts.

Previously, Querin and colleagues used a multivariable CPH to compare the predictive power of clinical and spinal cord imaging features in ALS in a cohort of 49 ALS patients, and concluded that spinal MRI measures were more predictive than clinical measures~\cite{querinSpinalCordMultiparametric2017}.
In this chapter, univariable, unimodal multivariable, and multimodal multivariable CPH models were used to investigate the relationship between the time to death and the clinical and imaging features in a larger cohort of 125 MND patients.

%\begin{itemize}
%    \item Cox proportional hazards model - what is it?
%    \item What is my hypothesis: using clinical and imaging features together in a simple cox regression will need to hugher concordance than imaging and clinical data alone
%    \item What is concordance? How is it calculated?
%    \item Examples of cox models in ALS before:
%\end{itemize}

\section{Data}

Data from two studies was used for this survival analysis: ALS Biomarkers Study and Opsedale San Raffaele.
Both of these datasets contain clinical information on MND patients and structural imaging conducted during their disease course.

The outcome of interest in this analysis is time to death, censored by date of censorship if recorded in the dataset or date of last data update if not.
The Ospedale San Raffaele cohort defines their endpoint as death or tracheostomy, but the ALS Biomarkers Study only defines their endpoint as death.

The clinical features in this study are the patient's sex, baseline ALSFRS-R, diagnostic delay, age at diagnosis, site of onset (categorised as bulbar and non-bulbar), signs of FTD, and their MND subtype (categorised as ALS and non-ALS).
These features were chosen for their clinical relevance to survival in MND and their availability in both datasets.

Patients were excluded if they did not have a T1- or T2-weighted MRI within 12 months before or after an MND diagnosis.
Regional brain volumes were extracted from the MRI using SynthSeg~\cite{billotSynthSegDomainRandomisation2021}, a modality-agnostic deep-learning segmentation tool.
A modality agnostic tool was chosen to overcome the inconsistency in MRI protocols within the ALS Biomarkers Study and between the ALS Biomarkers Study and Ospedale San Raffaele's MND cohort.
The dimensionality of the 33 regions was reduced to 12 by summing right and left regions and choosing regions relevant to MND pathology.
The remaining regions were z-score normalised.

\begin{table}
\centering
\caption{Demographics and clinical characteristics of the patients included in the analysis. ALSFRSr: ALS Functional Rating Scale-Revised.}
\label{tab:coxdemographics}
\begin{tabular}{|ll|}
\hline
              \textbf{Variable}                          &      \\
\hline
 n                               & 125         \\\hline
 Sex, n (\%)          & \\
 \hspace{5mm}Female & 55 (44.0)   \\
\hspace{5mm}Male & 70 (56.0)   \\\hline
 ALSFRSr, mean (SD)                 & 38.9 (6.4)  \\\hline
 Survival (months), mean (SD)         & 34.3 (27.3) \\\hline
 Diagnostic Delay (months), mean (SD)  & 13.6 (13.2) \\\hline
 Age at Diagnosis (years), mean (SD)  & 62.6 (11.4) \\\hline
 Site of Onset, n (\%)        &  \\
 \hspace{5mm}Non-bulbar   & 91 (72.8)   \\
 \hspace{5mm}Bulbar  & 34 (27.2)   \\\hline
 Frontotemporal Dementia, n (\%)       & \\
 \hspace{5mm}Not present & 87 (69.6)   \\
\hspace{5mm}Present & 38 (30.4)   \\\hline
 MND Type, n (\%)                & \\
 \hspace{5mm}Not ALS   & 21 (16.8)   \\
 \hspace{5mm}ALS   & 104 (83.2)  \\\hline
 Outcome, n (\%)                          & \\
 \hspace{5mm}Censored   & 21 (16.8)   \\
\hspace{5mm}Died   & 104 (83.2)  \\\hline

\end{tabular}
\end{table}

The demographics and clinical characteristics of the patients who were included in the analysis are shown in Table~\ref{tab:coxdemographics}.
Out of the 125 patients, 21 were censored and 104 died during the study period.
Censored patients were those who were still alive at the end of the study period (or at the time of data download: 5th March 2024) or who were lost to follow-up before the end of the study period.

\section{Methods}

A CPH model is expressed as
\begin{equation}\label{eq:coxhazard}
    h(t) = h_0(t) \exp{(\beta_1 X_1 + \beta_2 X_2 + ... + \beta_n X_n)},
\end{equation}
where $t$ is the survival time, $h(t)$ is the hazard function, $\bold{X}$ are the variables investigated, $h_0(t)$ is the baseline hazard if all the variables were 0.
The hazard ratios (HRs) are represented as $\beta$, with $\beta_1$ being the hazard ratio for the variable $X_1$.
A HR larger than 1 indicates the variable is associated with a poorer prognosis, or increased risk of the event, which is death in this CPH application.
The assumption of proportional hazards is that each individual in the analysis has the same hazard function, but the hazard functions are scaled by a constant factor, which is not dependent on time.
The Python package, lifelines, was used to implement the CPH models and to test the proportional hazards assumption (citation here).
Since the aim of this analysis was to see how multimodal data affects survival analysis of MND, four models were run:
\begin{itemize}
\setlength\itemsep{-0.5em}
    \item Univariable model: each feature was tested individually to see if it was associated with survival without adjusting for other features.
    \item Clinical-only model: multivariable model with only clinical features.
    \item Imaging-only model: multivariable model with only imaging features.
    \item Clinical and imaging model: multivariable model with both clinical and imaging features.
\end{itemize}

%The models we used were not stratified by any variables, as the sample size was relatively small and stratifying the model may lead to less informative results than just including the features and acknowledging the violation of the proportional hazards assumption.

The CPH models estimated the hazard ratios and their 95\% confidence intervals for each variable, with significance level set at $p<0.05$.

The quality of models fit to the data was assessed using the concordance index, which is a measure of how well the model predicts the order of the survival times, and the Akaike Information Criterion (AIC), which is a measure of the model's goodness of fit balanced with its complexity.

\section{Results}

\input{tables/coxtables}

Univariable
- list the significant features and their HRs and CIs

Clinical-only:
\begin{itemize}
    \item Including all clinical features: list the results and say that proportional hazards were broken by diagnosis age (p=0.002) and diagnostic delay (p=0.038)
    \item Doing univariable screening gives same significant factors and same broken assumptions
    \item Hazard ratio plot
    \item Kaplan Meier plot
\end{itemize}

Imaging-only:
\begin{itemize}
    \item With all features - proportional hazards broken by CSF (p=0.005) and cerebral white matter (p=0.0325)
    \item List significant features
    \item Significant features include cerebral white matter which was not significant in the unvariable model
    \item Because of high colinearity, we also ran the model with only the univariable significant features - no proportional hazards broken
    \item Link to table with those results and list new significant features: brain stem ,csf, amygdala, lateral ventricles, caudate, thalamus
    \item Hazard ratio plot
    \item Kaplan Meier plot
\end{itemize}

Clinical and imaging:
\begin{itemize}
    \item Significant features and their hazard ratios for all features included - alsfrsr, als, cerebral white matter (harmful)
    \item Proportional hazards broken by sex, bulbar onset, and cwm - all of which are univariable insignificant
    \item Ran again with uni significant features - no proportional hazards broken
    \item ALSFRS-R, ALS, amygdala, lateral ventricles
    \item Hazard ratio plot
    \item Kaplan Meier plot
\end{itemize}

\section{Discussion}

Univariable model:
\begin{itemize}
    \item Discuss the logic of the significant features
    \item What are the limitations of a univariable model - doesn't take into account the relationships between features
\end{itemize}

Clinical model:
\begin{itemize}
    \item Proportional hazards were broken by diagnosis age and diagnostic delay
    \item Why are we ok with this? Because we have a relatively small sample size, stratifying the model may lead to worse results than just including the features and acknowledging the violation
    \item And the hazard directions are consistent with the literature, so the model isn't completely wrong
    \item Talk about the significant features and their hazard ratios - do they make sense
    \item What about features that weren't significant - surprising? Not surprising? Look at demographics table
\end{itemize}

Imaging model:
\begin{itemize}
    \item Significant features include cerebral white matter which was not significant in the unvariable model
    \item With the univariable model, more features were significant, and all were clinically intuitive apart from thalamus
    \item Protective in univariable, hazard in multivariable - why? could be to do with the high collinearity still in the model
\end{itemize}

Clinical and imaging model:
\begin{itemize}
    \item proportional hazards fixed with uni significant features and resulting features are all clinically intuitive, although amygdala being significant over more intuitive features is surprising
    \item Two clinical and two imaging features were significant - shows that the imaging features are adding information to the model
    \item Talk about each significant feature
    \item Fit statistics: fit improved with multimodal features - this could be just because we're adding more features, but it could also be because we're adding more information
\end{itemize}

Limitations:
\begin{itemize}
    \item Small-ish sample size
    \item Multi-site without harmonisation
    \item Univariable screening - a controversial approach.
    \item However, colinearity of features doesn't diminish the results
\end{itemize}

Take home message:
\begin{itemize}
    \item Using imaging-derived feature with clinical features increases concordance, more information into the model is better, makes the clinical measure significant as well when it wasn't before
    \item Would this result also be sustained when using more sophisticated machine learning models? Instinct says yes because they can handle more features and more complex relationships between features
\end{itemize}

\section{Conclusion}
\begin{itemize}
    \item Link to next chapter: we've shown that using imaging and clinical together is better than using them alone
    \item Let's see if we can improve on this by using more sophisticated machine learning models
\end{itemize}